plugins {
    id 'java'
    id 'maven-publish'
    id "com.github.johnrengelman.shadow" version "7.1.2"
}

repositories {
    maven { url = uri('https://repo.fantasyrealms.net/other-snapshots') }
    maven { url = uri('https://repo.fantasyrealms.net/releases') }
    maven { url = uri('https://repo.extendedclip.com/content/repositories/placeholderapi/') }
    maven { url = uri('https://repo.glaremasters.me/repository/concuncan/') }
    maven { url = uri('https://repo.maven.apache.org/maven2/') }
    maven { url = uri('https://jitpack.io') }

    mavenCentral()
    mavenLocal()
}

group = 'cc.happyareabean'
version = System.getProperty("version")
description = 'SWMHook'
java.sourceCompatibility = JavaVersion.VERSION_1_8

dependencies {
    implementation 'de.exlll:configlib-core:2.2.1'

    implementation 'com.github.Revxrsal.Lamp:common:3.1.2'
    implementation 'com.github.Revxrsal.Lamp:bukkit:3.1.2'

    compileOnly 'org.spigotmc:spigot-api:1.8.8-R0.1-SNAPSHOT'
    compileOnly 'org.spigotmc:spigot:1.8.8-R0.1-SNAPSHOT'

    compileOnly 'me.clip:placeholderapi:2.10.10'
    compileOnly 'com.grinderwolf:slimeworldmanager-api:2.2.1'
    compileOnly 'com.grinderwolf:slimeworldmanager-plugin:2.2.1'
    compileOnly "rip.diamond:Eden:1.0.X-BETA"

    compileOnly 'org.projectlombok:lombok:1.18.24'
    annotationProcessor 'org.projectlombok:lombok:1.18.24'

    testCompileOnly 'org.projectlombok:lombok:1.18.24'
    testAnnotationProcessor 'org.projectlombok:lombok:1.18.24'
}

import com.github.jengelman.gradle.plugins.shadow.tasks.ConfigureShadowRelocation

shadowJar {
    archiveClassifier.set('')
    archiveVersion.set('')
}

tasks.register('relocateShadowJar', ConfigureShadowRelocation) {
    target = tasks.shadowJar
    prefix = "cc.happyareabean.swmhook.libs"
}

tasks.shadowJar.dependsOn tasks.relocateShadowJar

build {
    finalizedBy {
        tasks.shadowJar
    }
}

compileJava { // Preserve parameter names in the bytecode
    options.compilerArgs += ["-parameters"]
    options.fork = true
    options.forkOptions.executable = "javac"
}

publishing {
    publications {
        maven(MavenPublication) {
            from(components.java)
        }
    }
}
